<!DOCTYPE html>
<html>
	<head>
	</head>
	<body onload="startGame()">
		<canvas id="game area" width="400" height="400" style="border:1px solid #c3c3c3;">
		</canvas>
		<p>WASD to move</p>
		<p id="lives"></p>
		<p id="wave number"></p>
		<script type="text/javascript" src="entities.js"></script>
		<script>
			const startGame = () => {
				theGame.start();
			}

			let player = {
				xPos: 200,
				yPos: 200,
				vX: 0,
				vY: 0,
				reload: 15,
				cooldown: 0,
				damage: 1,
				lives: 3
			}
			let keys = {
				87: false,
				65: false,
				83: false,
				68: false
				
			}
			let mouse = {
				x: 0,
				y: 0
				
			}
			let bullets = [];
			let enemies = [];
			let waves = 0;
			let wavenum = 0;
			
			const theGame = {
				canvas : document.getElementById("game area"),
				start : function() {
					this.canvas.width = 400;
					this.canvas.height = 400;
					this.context = this.canvas.getContext("2d");
					this.interval = setInterval(updateGame, 20);
					window.addEventListener("mousedown", function (e) {
						mouse.down = true;
						let margin = document.getElementById("game area").getBoundingClientRect();
						mouse.x = e.clientX - margin.left;
						mouse.y = e.clientY - margin.top;
					})
					window.addEventListener("mouseup", function (e) {
						mouse.down = false;
						
					})
					window.addEventListener('keydown', function (e) {
							e.preventDefault();
							keys[e.keyCode] = true;
						})
					window.addEventListener('keyup', function (e) {
						keys[e.keyCode] = false;
					})
				},
				stop : function() {
					clearInterval(this.interval);
				},
				clear : function() {
					this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
				}
			}
			const updateGame = () => {
				theGame.clear();
				if (keys[87]) {
					if(player.vY < -5) {
						player.vY = -5
					} else {
					   player.vY -= 0.1;
					}
				} 
				if (keys[65]) {
					if(player.vX < -5) {
						player.vX = -5
					} else {
					   player.vX -= 0.1;
					}
				} 
				if (keys[83]) {
					if(player.vY > 5) {
						player.vY = 5
					} else {
					   player.vY += 0.1;
					}
				}
				if (keys[68]) {
					if(player.vX > 5) {
						player.vX = 5
					} else {
					   player.vX += 0.1;
					}
				}
				if (player.xPos < 0) {
					player.xPos = 0;
					player.vX = -player.vX * 1/2;
				}
				if (player.xPos > 400) {
					player.xPos = 400;
					player.vX = -player.vX * 1/2;
				}
				if (player.yPos < 0) {
					player.yPos = 0;
					player.vY = -player.vY * 1/2;
				}
				if (player.yPos > 400) {
					player.yPos = 400;
					player.vY = -player.vY * 1/2;
				}
				player.cooldown++;
				if (mouse.down === true) {
					window.addEventListener("mousemove", function (e) {
						let margin = document.getElementById("game area").getBoundingClientRect();
						mouse.x = e.clientX - margin.left;
						mouse.y = e.clientY - margin.top;
					})
					if(player.cooldown >= player.reload) {
						let angle = Math.atan2(player.xPos-mouse.x,player.yPos-mouse.y); 
						bullets.push(new Bullet(player.xPos,player.yPos,-Math.sin(angle)*7.5,-Math.cos(angle)*7.5));
						player.cooldown = 0;
					}
				}
				player.xPos += player.vX;
				player.yPos += player.vY;
				
				entityUpdate();
				update();
			}
			const update = () => {
				let wavestop = false;
				for(let i = 0; i < enemies.length; i++) {
					if(enemies[i].stopwaves === true) {
						wavestop = true;
					}
				}
				waves++;
				if(waves > 300 && wavestop === false) {
					wave();
					waves = 0;
				}
				let canvas = theGame.canvas;
				let shapes = canvas.getContext("2d");
				shapes.fillStyle = "#FFFFFF";
				let angle = Math.atan2(player.xPos-mouse.x,player.yPos-mouse.y);
				let xlength = Math.sin(angle-Math.PI/2)*5+player.xPos;
				let ylength = Math.cos(angle-Math.PI/2)*5+player.yPos;
				let xlength2 = Math.sin(angle+Math.atan2(5,20))*-Math.sqrt(Math.pow(20,2)+Math.pow(5,2))+player.xPos;
				let ylength2 = Math.cos(angle+Math.atan2(5,20))*-Math.sqrt(Math.pow(20,2)+Math.pow(5,2))+player.yPos;
				let xlength3 = Math.sin(angle-Math.atan2(5,20))*-Math.sqrt(Math.pow(20,2)+Math.pow(5,2))+player.xPos;
				let ylength3 = Math.cos(angle-Math.atan2(5,20))*-Math.sqrt(Math.pow(20,2)+Math.pow(5,2))+player.yPos;
				let xlength4 = Math.sin(angle+Math.PI/2)*5+player.xPos;
				let ylength4 = Math.cos(angle+Math.PI/2)*5+player.yPos;
				shapes.beginPath();
				shapes.moveTo(xlength,ylength);
				shapes.lineTo(xlength2,ylength2);
				shapes.lineTo(xlength3,ylength3);
				shapes.lineTo(xlength4,ylength4);
				shapes.fill();
				shapes.stroke();
				shapes.closePath();
				shapes.beginPath();
				shapes.arc(player.xPos,player.yPos,10,0,2*Math.PI);
				shapes.fill();
				shapes.stroke();
				shapes.closePath();
				for(let i = 0; i < bullets.length; i++) {
					if(bullets[i].dead !== true) {
						shapes.beginPath();
						shapes.arc(bullets[i].xPos,bullets[i].yPos,2.5,0,2*Math.PI);
						shapes.fill();
						shapes.stroke();
						shapes.closePath();
					}
				}
				for(let i = 0; i < enemies.length; i++) {
					if(enemies[i].dead !== true) {
						
						if(enemies[i].name === "crasher") {
							enemies[i].angle = Math.atan2((enemies[i].yPos-player.yPos),(enemies[i].xPos-player.xPos));
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							let angle = enemies[i].angle;
							let side = 5;
							
							let xlength = -Math.cos(angle)*side + x;
							let ylength = -Math.sin(angle)*side + y;
							let xlength2 = -Math.cos(angle+2*Math.PI/3)*side + x;
							let ylength2 = -Math.sin(angle+2*Math.PI/3)*side + y;
							let xlength3 = -Math.cos(angle+4*Math.PI/3)*side + x;
							let ylength3 = -Math.sin(angle+4*Math.PI/3)*side + y;
							shapes.beginPath();
							shapes.moveTo(xlength,ylength);
							shapes.lineTo(xlength2,ylength2);
							shapes.lineTo(xlength3,ylength3);
							shapes.lineTo(xlength,ylength);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
						}
						if(enemies[i].name === "big crasher") {
							enemies[i].angle = Math.atan2((enemies[i].yPos-player.yPos),(enemies[i].xPos-player.xPos));
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							let angle = enemies[i].angle;
							let side = 15;
							
							let xlength = -Math.cos(angle)*side + x;
							let ylength = -Math.sin(angle)*side + y;
							let xlength2 = -Math.cos(angle+2*Math.PI/3)*side + x;
							let ylength2 = -Math.sin(angle+2*Math.PI/3)*side + y;
							let xlength3 = -Math.cos(angle+4*Math.PI/3)*side + x;
							let ylength3 = -Math.sin(angle+4*Math.PI/3)*side + y;
							shapes.beginPath();
							shapes.moveTo(xlength,ylength);
							shapes.lineTo(xlength2,ylength2);
							shapes.lineTo(xlength3,ylength3);
							shapes.lineTo(xlength,ylength);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
						}
						if(enemies[i].name === "splitter") {
							enemies[i].angle += Math.PI/30;
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							let angle = enemies[i].angle;
							let side = 10;
							
							let xlength = -Math.cos(angle)*side + x;
							let ylength = -Math.sin(angle)*side + y;
							let xlength2 = -Math.cos(angle+1*Math.PI/3)*side + x;
							let ylength2 = -Math.sin(angle+1*Math.PI/3)*side + y;
							let xlength3 = -Math.cos(angle+2*Math.PI/3)*side + x;
							let ylength3 = -Math.sin(angle+2*Math.PI/3)*side + y;
							let xlength4 = -Math.cos(angle+3*Math.PI/3)*side + x;
							let ylength4 = -Math.sin(angle+3*Math.PI/3)*side + y;
							let xlength5 = -Math.cos(angle+4*Math.PI/3)*side + x;
							let ylength5 = -Math.sin(angle+4*Math.PI/3)*side + y;
							let xlength6 = -Math.cos(angle+5*Math.PI/3)*side + x;
							let ylength6 = -Math.sin(angle+5*Math.PI/3)*side + y;
							shapes.beginPath();
							shapes.moveTo(x,y);
							shapes.lineTo(xlength,ylength);
							shapes.lineTo(xlength2,ylength2);
							shapes.moveTo(x,y);
							shapes.lineTo(xlength2,ylength2);
							shapes.lineTo(xlength3,ylength3);
							shapes.moveTo(x,y);
							shapes.lineTo(xlength3,ylength3);
							shapes.lineTo(xlength4,ylength4);
							shapes.moveTo(x,y);
							shapes.lineTo(xlength4,ylength4);
							shapes.lineTo(xlength5,ylength5);
							shapes.moveTo(x,y);
							shapes.lineTo(xlength5,ylength5);
							shapes.lineTo(xlength6,ylength6);
							shapes.moveTo(x,y);
							shapes.lineTo(xlength6,ylength6);
							shapes.lineTo(xlength,ylength);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
						}
						if(enemies[i].name === "spawner boss") {
							shapes.beginPath();
							shapes.moveTo(0,380);
							shapes.lineTo(400,380);
							shapes.moveTo(400*(enemies[i].health/300),380);
							shapes.lineTo(400*(enemies[i].health/300),400);
							shapes.stroke();
							shapes.closePath;
							
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2((enemies[i].yPos-player.yPos),(enemies[i].xPos-player.xPos))+Math.PI;
							let angle = enemies[i].angle;

							let x1 = Math.sin(angle)*-10+x;
							let y1 = Math.cos(angle)*-10+y;
							let x2 = Math.sin(angle)*10+x;
							let y2 = Math.cos(angle)*10+y;
							let x3 = Math.sin(angle+Math.atan2(20,10))*(Math.sqrt(Math.pow(10,2)+Math.pow(20,2)))+x;
							let y3 = Math.cos(angle+Math.atan2(20,10))*(Math.sqrt(Math.pow(10,2)+Math.pow(20,2)))+y;
							let x4 = Math.sin(angle+Math.atan2(20,30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+x;
							let y4 = Math.cos(angle+Math.atan2(20,30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+y;
							let x5 = Math.sin(angle+Math.atan2(-20,30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+x;
							let y5 = Math.cos(angle+Math.atan2(-20,30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+y;
							let x6 = Math.sin(angle+Math.atan2(-20,-30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+x;
							let y6 = Math.cos(angle+Math.atan2(-20,-30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+y;
							let x7 = Math.sin(angle+Math.atan2(20,-30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+x;
							let y7 = Math.cos(angle+Math.atan2(20,-30))*(Math.sqrt(Math.pow(30,2)+Math.pow(20,2)))+y;
							let x8 = Math.sin(angle+Math.atan2(20,-10))*(Math.sqrt(Math.pow(10,2)+Math.pow(20,2)))+x;
							let y8 = Math.cos(angle+Math.atan2(20,-10))*(Math.sqrt(Math.pow(10,2)+Math.pow(20,2)))+y;
							
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x5,y5);
							shapes.lineTo(x6,y6);
							shapes.lineTo(x7,y7);
							shapes.lineTo(x8,y8);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							enemies[i].cooldown++;
							if(enemies[i].health <= 100) {
								if(enemies[i].cooldown >= 20) {
									enemies.push(new Crasher(x+(Math.random()-0.5)*20,y+(Math.random()-0.5)*20,0,0));
									enemies.push(new Crasher(x+(Math.random()-0.5)*20,y+(Math.random()-0.5)*20,0,0));
									enemies[i].cooldown = 0;
								}
							} else {
								if(enemies[i].cooldown >= 200) {
									enemies[i].cooldown = 0;
									var type = Math.random()*3;
									if(type <= 1) {
										enemies.push(new Crasher(x-30,y-30,0,0));
										enemies.push(new Crasher(x-30,y-10,0,0));
										enemies.push(new Crasher(x-30,y+10,0,0));
										enemies.push(new Crasher(x-30,y+10,0,0));
										enemies.push(new Crasher(x-10,y-30,0,0));
										enemies.push(new Crasher(x-10,y-10,0,0));
										enemies.push(new Crasher(x-10,y+10,0,0));
										enemies.push(new Crasher(x-10,y+30,0,0));
										enemies.push(new Crasher(x+10,y-30,0,0));
										enemies.push(new Crasher(x+10,y-10,0,0));
										enemies.push(new Crasher(x+10,y+10,0,0));
										enemies.push(new Crasher(x+10,y+30,0,0));
										enemies.push(new Crasher(x+30,y-30,0,0));
										enemies.push(new Crasher(x+30,y-10,0,0));
										enemies.push(new Crasher(x+30,y+10,0,0));
										enemies.push(new Crasher(x+30,y+30,0,0));
									} else if(type <= 2 && type > 1) {
										enemies.push(new BigCrasher(x-10,y-10,0,0));
										enemies.push(new BigCrasher(x-10,y+10,0,0));
										enemies.push(new BigCrasher(x+10,y-10,0,0));
										enemies.push(new BigCrasher(x+10,y+10,0,0));
									} else if(type <= 3 && type > 2) {
										enemies.push(new Splitter(x-10,y-10,0,0));
										enemies.push(new Splitter(x-10,y+10,0,0));
										enemies.push(new Splitter(x+10,y-10,0,0));
										enemies.push(new Splitter(x+10,y+10,0,0));
									}
								}
							}
						}
						if(enemies[i].name === "mini spawner") {
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2((y-player.yPos),(x-player.xPos))+Math.PI;
							let angle = enemies[i].angle;

							let x1 = Math.sin(angle)*-5+x;
							let y1 = Math.cos(angle)*-5+y;
							let x2 = Math.sin(angle)*5+x;
							let y2 = Math.cos(angle)*5+y;
							let x3 = Math.sin(angle+Math.atan2(10,5))*(Math.sqrt(Math.pow(5,2)+Math.pow(10,2)))+x;
							let y3 = Math.cos(angle+Math.atan2(10,5))*(Math.sqrt(Math.pow(5,2)+Math.pow(10,2)))+y;
							let x4 = Math.sin(angle+Math.atan2(10,15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+x;
							let y4 = Math.cos(angle+Math.atan2(10,15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+y;
							let x5 = Math.sin(angle+Math.atan2(-10,15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+x;
							let y5 = Math.cos(angle+Math.atan2(-10,15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+y;
							let x6 = Math.sin(angle+Math.atan2(-10,-15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+x;
							let y6 = Math.cos(angle+Math.atan2(-10,-15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+y;
							let x7 = Math.sin(angle+Math.atan2(10,-15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+x;
							let y7 = Math.cos(angle+Math.atan2(10,-15))*(Math.sqrt(Math.pow(15,2)+Math.pow(10,2)))+y;
							let x8 = Math.sin(angle+Math.atan2(10,-5))*(Math.sqrt(Math.pow(5,2)+Math.pow(10,2)))+x;
							let y8 = Math.cos(angle+Math.atan2(10,-5))*(Math.sqrt(Math.pow(5,2)+Math.pow(10,2)))+y;
							
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x5,y5);
							shapes.lineTo(x6,y6);
							shapes.lineTo(x7,y7);
							shapes.lineTo(x8,y8);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							enemies[i].cooldown++;
							if(enemies[i].cooldown >= 100) {
								enemies.push(new Crasher(x,y,0,0));
								enemies[i].cooldown = 0;
							}
						}
						if(enemies[i].name === "enemy bullet") {
							shapes.beginPath();
							shapes.arc(enemies[i].xPos,enemies[i].yPos,2.5,0,2*Math.PI);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
						}
						if(enemies[i].name === "shooter") {
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2(y-player.yPos,x-player.xPos)+Math.PI/2;
							enemies[i].angle2 += Math.PI/30;
							let angle = enemies[i].angle2;
							let x1 = Math.sin(angle-Math.PI/2)*-10 + x;
							let y1 = Math.cos(angle-Math.PI/2)*-10 + y;
							let x2 = Math.sin(angle)*-10 + x;
							let y2 = Math.cos(angle)*-10 + y;
							let x3 = Math.sin(angle+Math.PI/2)*-10 + x;
							let y3 = Math.cos(angle+Math.PI/2)*-10 + y;
							let x4 = Math.sin(angle+Math.PI)*-10 + x;
							let y4 = Math.cos(angle+Math.PI)*-10 + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							angle = enemies[i].angle;
							x1 = Math.sin(angle-Math.PI/2)*-2 + x;
							y1 = Math.cos(angle-Math.PI/2)*-2 + y
							x2 = Math.sin(angle+Math.PI/2)*-2 + x;
							y2 = Math.cos(angle+Math.PI/2)*-2 + y
							x3 = Math.sin(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y3 = Math.cos(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							x4 = Math.sin(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y4 = Math.cos(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();

							shapes.beginPath()
							shapes.arc(x,y,2.5,0,Math.PI*2);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();

							enemies[i].cooldown++;
							if(enemies[i].cooldown >= 25) {
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle)*3,-Math.cos(enemies[i].angle)*3));

								enemies[i].cooldown = 0;
							}

						}
						if(enemies[i].name === "triple shot") {
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2(y-player.yPos,x-player.xPos)+Math.PI/2;
							enemies[i].angle2 += Math.PI/30;
							let angle = enemies[i].angle2;
							let x1 = Math.sin(angle-Math.PI/2)*-10 + x;
							let y1 = Math.cos(angle-Math.PI/2)*-10 + y;
							let x2 = Math.sin(angle)*-10 + x;
							let y2 = Math.cos(angle)*-10 + y;
							let x3 = Math.sin(angle+Math.PI/2)*-10 + x;
							let y3 = Math.cos(angle+Math.PI/2)*-10 + y;
							let x4 = Math.sin(angle+Math.PI)*-10 + x;
							let y4 = Math.cos(angle+Math.PI)*-10 + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							angle = enemies[i].angle+Math.PI/4;
							x1 = Math.sin(angle-Math.PI/2)*-2 + x;
							y1 = Math.cos(angle-Math.PI/2)*-2 + y
							x2 = Math.sin(angle+Math.PI/2)*-2 + x;
							y2 = Math.cos(angle+Math.PI/2)*-2 + y
							x3 = Math.sin(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y3 = Math.cos(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							x4 = Math.sin(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y4 = Math.cos(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							
							angle = enemies[i].angle-Math.PI/4;
							x1 = Math.sin(angle-Math.PI/2)*-2 + x;
							y1 = Math.cos(angle-Math.PI/2)*-2 + y
							x2 = Math.sin(angle+Math.PI/2)*-2 + x;
							y2 = Math.cos(angle+Math.PI/2)*-2 + y
							x3 = Math.sin(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y3 = Math.cos(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							x4 = Math.sin(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y4 = Math.cos(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							
							angle = enemies[i].angle;
							x1 = Math.sin(angle-Math.PI/2)*-2 + x;
							y1 = Math.cos(angle-Math.PI/2)*-2 + y
							x2 = Math.sin(angle+Math.PI/2)*-2 + x;
							y2 = Math.cos(angle+Math.PI/2)*-2 + y
							x3 = Math.sin(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y3 = Math.cos(angle+Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							x4 = Math.sin(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + x;
							y4 = Math.cos(angle-Math.atan2(2,5))*-Math.sqrt(Math.pow(2,2)+Math.pow(5,2)) + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();

							shapes.beginPath()
							shapes.arc(x,y,2.5,0,Math.PI*2);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();

							enemies[i].cooldown++;
							if(enemies[i].cooldown >= 100) {
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+Math.PI/4)*3,-Math.cos(enemies[i].angle+Math.PI/4)*3));
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle-Math.PI/4)*3,-Math.cos(enemies[i].angle-Math.PI/4)*3));
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle)*3,-Math.cos(enemies[i].angle)*3));
								
								enemies[i].cooldown = 0;
							}

						}
						if(enemies[i].name === "shooter boss") {
							shapes.beginPath();
							shapes.moveTo(0,380);
							shapes.lineTo(400,380);
							shapes.moveTo(400*(enemies[i].health/2500),380);
							shapes.lineTo(400*(enemies[i].health/2500),400);
							shapes.stroke();
							shapes.closePath;
							
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2(y-player.yPos,x-player.xPos)+Math.PI/2;
							enemies[i].angle2 += Math.PI/360;
							let angle = enemies[i].angle2;
							let x1 = Math.sin(angle-Math.PI/2)*-50 + x;
							let y1 = Math.cos(angle-Math.PI/2)*-50 + y;
							let x2 = Math.sin(angle)*-50 + x;
							let y2 = Math.cos(angle)*-50 + y;
							let x3 = Math.sin(angle+Math.PI/2)*-50 + x;
							let y3 = Math.cos(angle+Math.PI/2)*-50 + y;
							let x4 = Math.sin(angle+Math.PI)*-50 + x;
							let y4 = Math.cos(angle+Math.PI)*-50 + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							angle = enemies[i].angle2;
							x1 = Math.sin(angle-Math.PI/4)*-50 + x;
							y1 = Math.cos(angle-Math.PI/4)*-50 + y;
							x2 = Math.sin(angle+Math.PI/4)*-50 + x;
							y2 = Math.cos(angle+Math.PI/4)*-50 + y;
							x3 = Math.sin(angle+(3*Math.PI)/4)*-50 + x;
							y3 = Math.cos(angle+(3*Math.PI)/4)*-50 + y;
							x4 = Math.sin(angle-(3*Math.PI)/4)*-50 + x;
							y4 = Math.cos(angle-(3*Math.PI)/4)*-50 + y;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();;
							
							angle = enemies[i].angle;
							x1 = Math.sin(angle-90)*-10 + enemies[i].xPos;
							y1 = Math.cos(angle-90)*-10 + enemies[i].yPos;
							x2 = Math.sin(angle+90)*-10 + enemies[i].xPos;
							y2 = Math.cos(angle+90)*-10 + enemies[i].yPos;
							x3 = Math.sin(angle+Math.atan2(20,30))*-Math.sqrt(Math.pow(20,2)+Math.pow(30,2)) + enemies[i].xPos;
							y3 = Math.cos(angle+Math.atan2(20,30))*-Math.sqrt(Math.pow(20,2)+Math.pow(30,2)) + enemies[i].yPos;
							x4 = Math.sin(angle-Math.atan2(20,30))*-Math.sqrt(Math.pow(20,2)+Math.pow(30,2)) + enemies[i].xPos;
							y4 = Math.cos(angle-Math.atan2(20,30))*-Math.sqrt(Math.pow(20,2)+Math.pow(30,2)) + enemies[i].yPos;
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							

							shapes.beginPath()
							shapes.arc(x,y,12.5,0,Math.PI*2);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();

							enemies[i].cooldown++;
							enemies[i].cooldown++;
							if(enemies[i].health <= 500 && enemies[i].cooldown >= 5) {
								var attack = Math.random()*3;

								if(attack <= 1) {
								enemies[i].attack = "spam";
								enemies[i].attackLength = 50;
								enemies[i].reload = 5;
								}
								if(attack <= 2 && attack > 1) {
								enemies[i].attack = "spread";
								enemies[i].attackLength = 50;
								enemies[i].reload = 25;
								}
								if(attack <= 3 && attack > 2) {
								enemies[i].attack = "shotgun";
								enemies[i].attackLength = 50;
								enemies[i].reload = 25;
								}
								enemies[i].cooldown = 0;
							} else if(enemies[i].cooldown >= 25) {
								var attack = Math.random()*3;

								if(attack <= 1) {
								enemies[i].attack = "spam";
								enemies[i].attackLength = 200;
								enemies[i].reload = 10;
								}
								if(attack <= 2 && attack > 1) {
								enemies[i].attack = "spread";
								enemies[i].attackLength = 200;
								enemies[i].reload = 50;
								}
								if(attack <= 3 && attack > 2) {
								enemies[i].attack = "shotgun";
								enemies[i].attackLength = 200;
								enemies[i].reload = 50;
								}
								enemies[i].cooldown = 0;
							}
							if(enemies[i].attack === "spam") {
								enemies[i].reloadCooldown++;
								if(enemies[i].reloadCooldown >= enemies[i].reload) {
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+(Math.random()-0.5)*Math.PI/9)*3,-Math.cos(enemies[i].angle+(Math.random()-0.5)*Math.PI/9)*3));
									enemies[i].reloadCooldown = 0;
								}
								enemies[i].attackLength--;
								enemies[i].cooldown = 0;
								if(enemies[i].attackLength <= 0) {
									enemies[i].attack = "none";
								}
							}
							if(enemies[i].attack === "shotgun") {
								enemies[i].reloadCooldown++;
								if(enemies[i].reloadCooldown >= enemies[i].reload) {
									for(var j = 0; j < Math.random()*5+5; j++) {
										enemies.push(new EnemyBullet(x,y,Math.sin(enemies[i].angle+Math.random()-0.5*20)*(Math.random()*2+2),Math.cos(enemies[i].angle+Math.random()-0.5*20)*(Math.random()*2+2)));
									}
									enemies[i].reloadCooldown = 0;
								}
								enemies[i].attackLength--;
								enemies[i].cooldown = 0;
								if(enemies[i].attackLength <= 0) {
								enemies[i].attack = "none";
								}

							}
							if(enemies[i].attack === "spread") {
								enemies[i].reloadCooldown++;
								if(enemies[i].reloadCooldown >= enemies[i].reload) {
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+Math.PI/4)*3,-Math.cos(enemies[i].angle+Math.PI/4)*3));
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle-Math.PI/4)*3,-Math.cos(enemies[i].angle-Math.PI/4)*3));
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+Math.PI/8)*3,-Math.cos(enemies[i].angle+Math.PI/8)*3));
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle-Math.PI/8)*3,-Math.cos(enemies[i].angle-Math.PI/8)*3));
									enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle)*3,-Math.cos(enemies[i].angle)*3));
									enemies[i].reloadCooldown = 0;
								}
								enemies[i].attackLength--;
								enemies[i].cooldown = 0;
								if(enemies[i].attackLength <= 0) {
									enemies[i].attack = "none";
								}

							}

						}
						if(enemies[i].name === "cross") {
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = enemies[i].angle+0.01;
							let angle = enemies[i].angle;
							
							let x1 = Math.sin(angle+Math.PI/4)*Math.sqrt(5*2)+x;
							let y1 = Math.cos(angle+Math.PI/4)*Math.sqrt(5*2)+y;
							let x2 = Math.sin(angle+Math.PI/2)*5+x1;
							let y2 = Math.cos(angle+Math.PI/2)*5+y1;
							let x3 = Math.sin(angle+Math.PI)*5+x2;
							let y3 = Math.cos(angle+Math.PI)*5+y2;
							let x4 = Math.sin(angle-Math.PI/2)*5+x3;
							let y4 = Math.cos(angle-Math.PI/2)*5+y3;
							let x5 = Math.sin(angle+Math.PI)*5+x4;
							let y5 = Math.cos(angle+Math.PI)*5+y4;
							let x6 = Math.sin(angle-Math.PI/2)*5+x5;
							let y6 = Math.cos(angle-Math.PI/2)*5+y5;
							let x7 = Math.sin(angle)*5+x6;
							let y7 = Math.cos(angle)*5+y6;
							let x8 = Math.sin(angle-Math.PI/2)*5+x7;
							let y8 = Math.cos(angle-Math.PI/2)*5+y7;
							let x9 = Math.sin(angle)*5+x8;
							let y9 = Math.cos(angle)*5+y8;
							let x10 = Math.sin(angle+Math.PI/2)*5+x9;
							let y10 = Math.cos(angle+Math.PI/2)*5+y9;
							let x11 = Math.sin(angle)*5+x10;
							let y11 = Math.cos(angle)*5+y10;
							let x12 = Math.sin(angle+Math.PI/2)*5+x11;
							let y12 = Math.cos(angle+Math.PI/2)*5+y11;
							
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x5,y5);
							shapes.lineTo(x6,y6);
							shapes.lineTo(x7,y7);
							shapes.lineTo(x8,y8);
							shapes.lineTo(x9,y9);
							shapes.lineTo(x10,y10);
							shapes.lineTo(x11,y11);
							shapes.lineTo(x12,y12);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
							enemies[i].cooldown++;
							if(enemies[i].cooldown >= 100) {
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+Math.PI/2)*3,-Math.cos(enemies[i].angle+Math.PI/2)*3));
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle-Math.PI/2)*3,-Math.cos(enemies[i].angle-Math.PI/2)*3));
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle+Math.PI)*3,-Math.cos(enemies[i].angle+Math.PI)*3));
								enemies.push(new EnemyBullet(x,y,-Math.sin(enemies[i].angle)*3,-Math.cos(enemies[i].angle)*3));
								
								enemies[i].cooldown = 0;
							}
							
						}
						if(enemies[i].name === "runner") {
							let x = enemies[i].xPos;
							let y = enemies[i].yPos;
							enemies[i].angle = -Math.atan2(y-player.yPos,x-player.xPos)-Math.PI/2;
							let angle = enemies[i].angle;
							
							let x1 = Math.sin(angle)*3+x;
							let y1 = Math.cos(angle)*3+y;
							let x2 = Math.sin(angle+3*Math.PI/4)*5+x1;
							let y2 = Math.cos(angle+3*Math.PI/4)*5+y1;
							let x3 = Math.sin(angle+Math.PI)*5+x2;
							let y3 = Math.cos(angle+Math.PI)*5+y2;
							let x4 = Math.sin(angle-Math.PI/4)*5+x3;
							let y4 = Math.cos(angle-Math.PI/4)*5+y3;
							let x5 = Math.sin(angle-3*Math.PI/4)*5+x4;
							let y5 = Math.cos(angle-3*Math.PI/4)*5+y4;
							let x6 = Math.sin(angle)*5+x5;
							let y6 = Math.cos(angle)*5+y5;
							
							shapes.beginPath();
							shapes.moveTo(x1,y1);
							shapes.lineTo(x2,y2);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x3,y3);
							shapes.lineTo(x4,y4);
							shapes.lineTo(x5,y5);
							shapes.lineTo(x6,y6);
							shapes.lineTo(x1,y1);
							shapes.fill();
							shapes.stroke();
							shapes.closePath();
						}
						playerCollision(i);
					}
				}
				document.getElementById("lives").innerHTML = "Lives: " + player.lives;
				document.getElementById("wave number").innerHTML = "Wave: " + wavenum;
				
				shapes.fillStyle = "#000000";
				if(player.lives <= 0) {
					theGame.stop();
					theGame.clear();
					shapes.font="10px Arial";
					shapes.fillText("you died lol",175,200);
					
				}
				if((wavenum === 14 || wavenum === 29) && waves > 200) {
					shapes.font="30px Arial";
					shapes.fillText("BOSS FIGHT",100,200);
				}
				
			}
			
			const playerCollision = (e) => {
				if(
					player.xPos - 10 < enemies[e].xPos + enemies[e].hitbox &&
					player.xPos + 10 > enemies[e].xPos - enemies[e].hitbox &&
					player.yPos - 10 < enemies[e].yPos + enemies[e].hitbox &&
					player.yPos + 10 > enemies[e].yPos - enemies[e].hitbox
				) {
					enemies[e].health -= 5;
					player.lives--;
					if(enemies[e].health <= 0) {
						enemies[e].dead = true;
					}
				}
			}
			const wave = () => {
				wavenum++;
				if(wavenum != 15 && wavenum !== 30) {
					let crashers = Math.random() * 3 + 1;
					if(wavenum > 10 && wavenum < 30) {
						crashers -= Math.random() * (wavenum - 10)/10;
						
					}
					if(wavenum > 30) {
						crashers += Math.random() * (wavenum - 40)/20;
					}
					for(crashers; crashers > 0; crashers--) {
						enemies.push(new Crasher(Math.random()*400,0,0,0));
					}
				}
				if(wavenum >= 5 && wavenum !== 30) {
					let bigCrashers = Math.random() * 2;
					if(wavenum > 30) {
						bigCrashers += Math.random() * (wavenum - 30)/75;
					}
					for(bigCrashers; bigCrashers > 0; bigCrashers--) {
						enemies.push(new BigCrasher(Math.random()*400,0,0,0));
					}
				}
				if(wavenum >= 10 && wavenum != 15 && wavenum !== 30) {
					let splitters = Math.random() * 2;
					if(wavenum > 30) {
						splitters += Math.random() * (wavenum - 30)/100;
					}
					for(splitters; splitters > 0; splitters--) {
						enemies.push(new Splitter(Math.random()*400,0,0,0));
					}
				}
				if(wavenum === 15) {
					enemies.push(new SpawnerBoss(200,0,0,0));
					
				}
				if(wavenum >= 16 && wavenum !== 30) {
					let miniSpawners = Math.random() * 2;
					if(wavenum > 30) {
						miniSpawners += Math.random() * (wavenum - 30)/100;
					}
					for(miniSpawners; miniSpawners > 0; miniSpawners--) {
						enemies.push(new MiniSpawner(Math.random()*400,0,0,0));
					}
				}
				if(wavenum >= 20 && wavenum !== 30) {
					let shooters = Math.random() * 2;
					if(wavenum > 30) {
						shooters += Math.random() * (wavenum - 30)/200;
					}
					for(shooters; shooters > 0; shooters--) {
						enemies.push(new Shooter(Math.random()*400,0,0,0));
					}
				}
				if(wavenum >= 25) {
					let tripleShots = 1;
					if(wavenum > 30) {
						tripleShots += Math.random() * (wavenum - 30)/500;
					}
					for(tripleShots; tripleShots > 0; tripleShots--) {
						enemies.push(new TripleShot(Math.random()*400,0,0,0));
					}
				}
				if(wavenum === 30) {
					enemies.push(new ShooterBoss(200,0,0,0));
					
				}
				if(wavenum >= 31) {
					let crosses = 1;
					if(wavenum > 30) {
						crosses += Math.random() * (wavenum - 30)/500;
					}
					for(crosses; crosses > 0; crosses--) {
						enemies.push(new Cross(Math.random()*400,0,0,0));
					}
				}
				if(wavenum >= 35) {
					let runners = Math.random() * 3 + 1;
					if(wavenum > 30) {
						runners += Math.random() * (wavenum - 40)/20;
					}
					for(runners; runners > 0; runners--) {
						enemies.push(new Runner(Math.random()*400,0,0,0));
					}
				}
				player.damage = wavenum*0.2 + 1;
				player.reload = Math.pow(19/20,wavenum+1) * 15;
				if(wavenum % 5 === 0) {
					player.lives++;
				}
			}
			
		</script>
	</body>
</html>

